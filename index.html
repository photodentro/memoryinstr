<!doctype html> 
<!-- Copyright (C) 2018 Alkis Georgopoulos <alkisg@gmail.com>. License: GPLv3. -->
<html lang="el"> 
<head> 
  <meta charset="UTF-8" />
  <!-- Using this metatag users can't scale the page using pinchIn/out gestures on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Παιχνίδι μνήμης</title>  
  <script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
  <style type="text/css">
    /* Remove margins and HTML scrollbars */
    body, html  {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
    }
    #mainCanvas {
    padding: 0;
    margin: auto;
    display: block;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    }
  </style>
</head>

<body onLoad="init();">
  <div style="border-width:10px;border-color:white;">
    <canvas id="mainCanvas" width="320" height="180">
      Your browser doesn't support HTML5!
    </canvas>
  </div>
<script>//where everything happens
  var statusText = "";
  var lvlText = 1;
  var menuBar = [];
  const ratio = 16.0/9;
  var bg;
  var resourceNames = ["01_cat.png","02_pig.png","03_bear.png","04_hippopotamus.png","05_penguin.png","06_cow.png","07_sheep.png","08_turtle.png","09_panda.png","10_chicken.png","11_redbird.png","12_wolf.png","13_monkey.png","14_fox.png","15_bluebirds.png","16_elephant.png","17_lion.png","18_gnu.png","19_bluebaby.png","20_greenbaby.png","21_frog.png","backcard.png","emptycard.png","background.svg","bar_help.svg","bar_home.svg","bar_next.svg","bar_previous.svg",];
  var resources = [];
  var resourcesLoaded = 0;

  function imgByName(name) {
    return resources[resourceNames.indexOf(name)];
  }
 function queueFileLoad(event) {
    resourcesLoaded++;
    statusText.text = "Φόρτωση " + parseInt(100*resourcesLoaded/resourceNames.length) + " %";
    stage.update();
    if (resourcesLoaded == resourceNames.length){
      queueComplete(event);
    }
  }
  function init(){
    console.clear();
    stage = new createjs.Stage("mainCanvas");
    stage.enableMouseOver();
     // Resource preloading
    for (var i = 0; i < resourceNames.length; i++) {
      resources[i] = new Image();
      resources[i].src = "resource/" + resourceNames[i];
      resources[i].onload = queueFileLoad;
    }
    bg = new createjs.Bitmap(imgByName("background.svg"));
    
    bg.scaleX = stage.canvas.width / bg.image.width;
    bg.scaleY = stage.canvas.height / bg.image.height;
    bg.alpha = 0.5;
    stage.addChild(bg);
    stage.update();
    resize();
    window.addEventListener('resize', resize, false);
  }
 
  function queueComplete(event) {
    console.log("Finished loading resources");
    console.log("Let's get this party started!");
    
    var onMenuClick = [onMenuHelp, onMenuHome, onMenuPrevious, onMenuNext];
    for (i = 0; i < 4; i++) {
      var menuImageStartIndex = resourceNames.indexOf('bar_help.svg');
      menubar[i] = new createjs.Bitmap(resources[menuImageStartIndex+i]);
      menubar[i].addEventListener("click", onMenuClick[i]);
      menubar[i].addEventListener("mouseover", function(event) {
        // Bring the target on top in its container, mostly for the rotation animation
        event.target.parent.setChildIndex(event.target, event.target.parent.numChildren - 1);
        event.target.scaleX = 1.2*event.target.savedscaleX;
        event.target.scaleY = 1.2*event.target.savedscaleY;
        stage.update();
      });
      menubar[i].addEventListener("mouseout", function(event) {
        event.target.scaleX = event.target.savedscaleX;
        event.target.scaleY = event.target.savedscaleY;
        stage.update();
      });
      stage.addChild(menubar[i]);
    }
    lvlText = new createjs.Text("1", "20px Arial", "white");
    lvlText.textAlign = "center";
    lvlText.textBaseline = "middle";

    if (level + 1 < 10) {
      lvlText.x -= bbs/4;
      menubar[3].x -= bbs/2;
    }
    stage.addChild(lvlText);
    
    stage.update();
  }
  function resize() {
    // Resize the canvas element
    winratio = window.innerWidth/window.innerHeight;
    if (winratio >= ratio) {
      stage.canvas.height = window.innerHeight;
      stage.canvas.width = stage.canvas.height * ratio;
    } else {
      stage.canvas.width = window.innerWidth;
      stage.canvas.height = stage.canvas.width / ratio;
    }
    var bbs = stage.canvas.height / 10;  // bar button size
    var bbm = bbs / 5;  // bar button margin
    for (i = 0; i < 4; i++) {
      // Leave one space for the level
      if (i < 3)
        j = i;
      else
        j = i + 1;
      menubar[i].scaleX = bbs / menubar[i].image.width;
      menubar[i].scaleY = bbs / menubar[i].image.height;
      menubar[i].regX = menubar[i].image.width / 2;
      menubar[i].regY = menubar[i].image.height / 2;
      menubar[i].x = (j + 1)*bbm + bbs/2 + j*bbs;
      menubar[i].y = stage.canvas.height - bbm - bbs/2;
      // These copies are used to preserve the original scale on mouseover
      menubar[i].savedscaleX = menubar[i].scaleX;
      menubar[i].savedscaleY = menubar[i].scaleY;
    }
    lvlText.text = level + 1;
    lvlText.x = (3 + 1)*bbm + bbs/2 + 3*bbs;
    lvlText.y = stage.canvas.height - bbm/2 - bbs/2;
    lvlText.font = parseInt(2*bbs/2) + "px Arial";
    
    bg.scaleX = stage.canvas.width / bg.image.width;
    bg.scaleY = stage.canvas.height / bg.image.height;
    stage.update();
  }
  function onMenuHelp(event) {
    alert("Ανοίξτε τις ίδιες κάρτες!");
  }

function onMenuHome(event) {
  init();
}

function onMenuPrevious(event) {
  initLevel((level+5) % 6);
}

function onMenuNext(event) {
  initLevel((level+1) % 6);
}

function initLevel(level){
  lvlText = level;

}
</script>
</body>
</html>